(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2089:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>u}),s(908),s(1506),s(5866);var r=s(3191),o=s(8716),i=s(7922),n=s.n(i),a=s(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);s.d(t,l);let u=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,908)),"/home/linx/codes/itcsms/smis-sso/test-webauth/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/home/linx/codes/itcsms/smis-sso/test-webauth/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/linx/codes/itcsms/smis-sso/test-webauth/app/page.tsx"],d="/page",h={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},1821:()=>{},2484:(e,t,s)=>{Promise.resolve().then(s.bind(s,8743))},3689:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},5377:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthProbeResponse=t.SmisSsoClient=void 0;let r=s(2249),o=s(6508);class i{constructor(e){this.config=e,this.storage=(0,o.getDefaultStorage)(),this.storageKey=e.storageKey??`smis-sso:${e.appKey}`,this.timeoutMs=e.timeoutMs??15e3,this.pollIntervalMs=e.pollIntervalMs??250,this.authOrigin=new URL(e.authBaseUrl).origin}getCachedSession(){let e=(0,o.readSession)(this.storage,this.storageKey);return e?new Date(e.expiresAt).getTime()<=Date.now()?((0,o.storeSession)(this.storage,this.storageKey,null),null):e:null}async ensureSession(){let e=this.getCachedSession();if(e)return e;throw Error("ensureSession requires a browser runtime to open the auth probe")}async loadAuthorizations(e){let t=e??await this.ensureSession();return(0,r.fetchAuthorizations)(this.config,t)}clearSession(){(0,o.storeSession)(this.storage,this.storageKey,null)}launchAuthProbe(){return new Promise((e,t)=>{let s=(0,r.buildAuthUrl)(this.config);s.searchParams.set("appKey",this.config.appKey);let o=window.open(s.toString(),"_blank","width=480,height=640");if(!o){t(Error("Unable to open auth probe window"));return}let i=window.setTimeout(()=>{window.removeEventListener("message",n),o.close(),t(Error("Auth probe timed out"))},this.timeoutMs),n=t=>{t.origin===this.authOrigin&&t.data&&"smis:sso:session"===t.data.type&&(window.clearTimeout(i),window.removeEventListener("message",n),o.close(),e(t.data.payload))};window.addEventListener("message",n);let a=window.setInterval(()=>{o.closed&&(window.clearInterval(a),window.clearTimeout(i),window.removeEventListener("message",n),t(Error("Auth probe was closed before completing sign-in")))},this.pollIntervalMs)})}}t.SmisSsoClient=i,t.createAuthProbeResponse=e=>{}},2249:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAuthorizations=t.buildAuthUrl=void 0,t.buildAuthUrl=e=>new URL(e.probePath??"/sso/probe",e.authBaseUrl);let s=async(e,t)=>{let s=new URL("/api/sso/authorizations",e.authBaseUrl),r=e.fetch??fetch,o=await r(s.toString(),{headers:{Authorization:`Bearer ${t.accessToken}`,"X-SMIS-APP-KEY":e.appKey}});if(!o.ok)throw Error(`Failed to load authorizations (${o.status})`);return await o.json()};t.fetchAuthorizations=s},5054:(e,t,s)=>{"use strict";var r=Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]},o=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),o(s(5377),t),o(s(2249),t),o(s(6508),t),o(s(8341),t)},6508:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readSession=t.storeSession=t.getDefaultStorage=t.MemoryStorage=void 0;class s{constructor(){this.store=new Map}getItem(e){return this.store.has(e)?this.store.get(e):null}setItem(e,t){this.store.set(e,t)}removeItem(e){this.store.delete(e)}}t.MemoryStorage=s,t.getDefaultStorage=()=>new s,t.storeSession=(e,t,s)=>{if(!s){e.removeItem(t);return}e.setItem(t,JSON.stringify(s))},t.readSession=(e,t)=>{let s=e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(s){return e.removeItem(t),null}}},8341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8743:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(326),o=s(7577),i=s(5054);function n(){let[e,t]=(0,o.useState)("http://localhost:3000"),[s,n]=(0,o.useState)("pp-demo-123456"),[a,l]=(0,o.useState)(null),[u,c]=(0,o.useState)(null),[d,h]=(0,o.useState)(null),[p,m]=(0,o.useState)(null),[g,x]=(0,o.useState)(!1),f=(0,o.useMemo)(()=>new i.SmisSsoClient({appKey:s,authBaseUrl:e}),[s,e]),b=(0,o.useCallback)(async()=>{m(null),x(!0);try{let e=await f.ensureSession();l(e)}catch(e){m(e?.message||"Failed to get session")}finally{x(!1)}},[f]),y=(0,o.useCallback)(async()=>{if(a){m(null),x(!0);try{let e=await f.loadAuthorizations(a);c(e)}catch(e){m(e?.message||"Failed to load authorizations")}finally{x(!1)}}},[f,a]),v=(0,o.useCallback)(async()=>{if(a){m(null),x(!0);try{let t=await fetch(`${e}/api/sso/authorizations/context`,{headers:{Authorization:`Bearer ${a.accessToken}`}});if(!t.ok)throw Error(await t.text());let s=await t.json();h(s)}catch(e){m(e?.message||"Failed to load contextual authorizations")}finally{x(!1)}}},[e,a]),w=(0,o.useCallback)(async()=>{if(a){m(null),x(!0);try{await fetch(`${e}/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a.refreshToken})}),l(null),c(null),h(null)}catch(e){m(e?.message||"Failed to logout")}finally{x(!1)}}},[e,a]);return(0,r.jsxs)("main",{children:[(0,r.jsxs)("div",{className:"card grid",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{children:"SMIS SSO Test Harness"}),r.jsx("p",{className:"muted",children:"Probe/login via popup, then fetch authorizations (flat + contextual)."}),(0,r.jsxs)("div",{style:{marginTop:20},children:[r.jsx("label",{children:"Auth Base URL"}),r.jsx("input",{value:e,onChange:e=>t(e.target.value)})]}),(0,r.jsxs)("div",{style:{marginTop:12},children:[r.jsx("label",{children:"App Key"}),r.jsx("input",{value:s,onChange:e=>n(e.target.value)})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:10,marginTop:18},children:[r.jsx("button",{onClick:b,disabled:g,children:"Probe / Login"}),r.jsx("button",{onClick:y,disabled:!a||g,children:"Load AuthZ"}),r.jsx("button",{onClick:v,disabled:!a||g,children:"Load Context"}),r.jsx("button",{onClick:w,disabled:!a||g,style:{background:"#f85149",color:"#fff"},children:"Logout"})]}),p&&r.jsx("p",{style:{color:"#f85149",marginTop:14},children:p})]}),(0,r.jsxs)("div",{children:[r.jsx("h2",{children:"Session"}),r.jsx("pre",{children:a?JSON.stringify(a,null,2):"No session yet"})]})]}),(0,r.jsxs)("div",{className:"grid",style:{marginTop:20},children:[(0,r.jsxs)("div",{className:"card",children:[r.jsx("h2",{children:"Flat authorizations"}),r.jsx("pre",{children:u?JSON.stringify(u,null,2):"Click Load AuthZ"})]}),(0,r.jsxs)("div",{className:"card",children:[r.jsx("h2",{children:"Context authorizations"}),r.jsx("pre",{children:d?JSON.stringify(d,null,2):"Click Load Context"})]})]})]})}},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>o});var r=s(9510);s(7272);let o={title:"SMIS SSO Test App",description:"Quick sandbox to exercise the SMIS SSO popup flow and auth APIs"};function i({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{children:e})})}},908:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>a});var r=s(8570);let o=(0,r.createProxy)(String.raw`/home/linx/codes/itcsms/smis-sso/test-webauth/app/page.tsx`),{__esModule:i,$$typeof:n}=o;o.default;let a=(0,r.createProxy)(String.raw`/home/linx/codes/itcsms/smis-sso/test-webauth/app/page.tsx#default`)},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[819],()=>s(2089));module.exports=r})();
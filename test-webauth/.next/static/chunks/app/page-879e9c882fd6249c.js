(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4934:function(e,t,s){Promise.resolve().then(s.bind(s,6774))},1245:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthProbeResponse=t.SmisSsoClient=void 0;let o=s(6830),i=s(7534);class n{getCachedSession(){let e=(0,i.readSession)(this.storage,this.storageKey);return e?new Date(e.expiresAt).getTime()<=Date.now()?((0,i.storeSession)(this.storage,this.storageKey,null),null):e:null}async ensureSession(){let e=this.getCachedSession();if(e)return e;let t=await this.launchAuthProbe();return(0,i.storeSession)(this.storage,this.storageKey,t),t}async loadAuthorizations(e){let t=null!=e?e:await this.ensureSession();return(0,o.fetchAuthorizations)(this.config,t)}clearSession(){(0,i.storeSession)(this.storage,this.storageKey,null)}launchAuthProbe(){return new Promise((e,t)=>{let s=(0,o.buildAuthUrl)(this.config);s.searchParams.set("appKey",this.config.appKey);let i=window.open(s.toString(),"_blank","width=480,height=640");if(!i){t(Error("Unable to open auth probe window"));return}let n=window.setTimeout(()=>{window.removeEventListener("message",r),i.close(),t(Error("Auth probe timed out"))},this.timeoutMs),r=t=>{t.origin===this.authOrigin&&t.data&&"smis:sso:session"===t.data.type&&(window.clearTimeout(n),window.removeEventListener("message",r),i.close(),e(t.data.payload))};window.addEventListener("message",r);let a=window.setInterval(()=>{i.closed&&(window.clearInterval(a),window.clearTimeout(n),window.removeEventListener("message",r),t(Error("Auth probe was closed before completing sign-in")))},this.pollIntervalMs)})}constructor(e){var t,s,o;this.config=e,this.storage=(0,i.getDefaultStorage)(),this.storageKey=null!==(t=e.storageKey)&&void 0!==t?t:"smis-sso:".concat(e.appKey),this.timeoutMs=null!==(s=e.timeoutMs)&&void 0!==s?s:15e3,this.pollIntervalMs=null!==(o=e.pollIntervalMs)&&void 0!==o?o:250,this.authOrigin=new URL(e.authBaseUrl).origin}}t.SmisSsoClient=n,t.createAuthProbeResponse=e=>{var t;null===(t=window.opener)||void 0===t||t.postMessage({type:"smis:sso:session",payload:e},window.location.origin)}},6830:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAuthorizations=t.buildAuthUrl=void 0,t.buildAuthUrl=e=>{var t;return new URL(null!==(t=e.probePath)&&void 0!==t?t:"/sso/probe",e.authBaseUrl)};let s=async(e,t)=>{var s;let o=new URL("/api/sso/authorizations",e.authBaseUrl),i=null!==(s=e.fetch)&&void 0!==s?s:fetch,n=await i(o.toString(),{headers:{Authorization:"Bearer ".concat(t.accessToken),"X-SMIS-APP-KEY":e.appKey}});if(!n.ok)throw Error("Failed to load authorizations (".concat(n.status,")"));return await n.json()};t.fetchAuthorizations=s},8606:function(e,t,s){"use strict";var o=Object.create?function(e,t,s,o){void 0===o&&(o=s);var i=Object.getOwnPropertyDescriptor(t,s);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,o,i)}:function(e,t,s,o){void 0===o&&(o=s),e[o]=t[s]},i=function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||o(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),i(s(1245),t),i(s(6830),t),i(s(7534),t),i(s(578),t)},7534:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readSession=t.storeSession=t.getDefaultStorage=t.MemoryStorage=void 0;class s{getItem(e){return this.store.has(e)?this.store.get(e):null}setItem(e,t){this.store.set(e,t)}removeItem(e){this.store.delete(e)}constructor(){this.store=new Map}}t.MemoryStorage=s,t.getDefaultStorage=()=>window.localStorage?window.localStorage:new s,t.storeSession=(e,t,s)=>{if(!s){e.removeItem(t);return}e.setItem(t,JSON.stringify(s))},t.readSession=(e,t)=>{let s=e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(s){return e.removeItem(t),null}}},578:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6774:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return r}});var o=s(7437),i=s(2265),n=s(8606);function r(){let[e,t]=(0,i.useState)("http://localhost:3000"),[s,r]=(0,i.useState)("pp-demo-123456"),[a,l]=(0,i.useState)(null),[u,c]=(0,i.useState)(null),[d,h]=(0,i.useState)(null),[g,p]=(0,i.useState)(null),[f,v]=(0,i.useState)(!1),w=(0,i.useMemo)(()=>new n.SmisSsoClient({appKey:s,authBaseUrl:e}),[s,e]),m=(0,i.useCallback)(async()=>{p(null),v(!0);try{let e=await w.ensureSession();l(e)}catch(e){p((null==e?void 0:e.message)||"Failed to get session")}finally{v(!1)}},[w]),y=(0,i.useCallback)(async()=>{if(a){p(null),v(!0);try{let e=await w.loadAuthorizations(a);c(e)}catch(e){p((null==e?void 0:e.message)||"Failed to load authorizations")}finally{v(!1)}}},[w,a]),S=(0,i.useCallback)(async()=>{if(a){p(null),v(!0);try{let t=await fetch("".concat(e,"/api/sso/authorizations/context"),{headers:{Authorization:"Bearer ".concat(a.accessToken)}});if(!t.ok)throw Error(await t.text());let s=await t.json();h(s)}catch(e){p((null==e?void 0:e.message)||"Failed to load contextual authorizations")}finally{v(!1)}}},[e,a]),b=(0,i.useCallback)(async()=>{if(a){p(null),v(!0);try{await fetch("".concat(e,"/auth/logout"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a.refreshToken})}),l(null),c(null),h(null)}catch(e){p((null==e?void 0:e.message)||"Failed to logout")}finally{v(!1)}}},[e,a]);return(0,o.jsxs)("main",{children:[(0,o.jsxs)("div",{className:"card grid",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{children:"SMIS SSO Test Harness"}),(0,o.jsx)("p",{className:"muted",children:"Probe/login via popup, then fetch authorizations (flat + contextual)."}),(0,o.jsxs)("div",{style:{marginTop:20},children:[(0,o.jsx)("label",{children:"Auth Base URL"}),(0,o.jsx)("input",{value:e,onChange:e=>t(e.target.value)})]}),(0,o.jsxs)("div",{style:{marginTop:12},children:[(0,o.jsx)("label",{children:"App Key"}),(0,o.jsx)("input",{value:s,onChange:e=>r(e.target.value)})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:10,marginTop:18},children:[(0,o.jsx)("button",{onClick:m,disabled:f,children:"Probe / Login"}),(0,o.jsx)("button",{onClick:y,disabled:!a||f,children:"Load AuthZ"}),(0,o.jsx)("button",{onClick:S,disabled:!a||f,children:"Load Context"}),(0,o.jsx)("button",{onClick:b,disabled:!a||f,style:{background:"#f85149",color:"#fff"},children:"Logout"})]}),g&&(0,o.jsx)("p",{style:{color:"#f85149",marginTop:14},children:g})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"Session"}),(0,o.jsx)("pre",{children:a?JSON.stringify(a,null,2):"No session yet"})]})]}),(0,o.jsxs)("div",{className:"grid",style:{marginTop:20},children:[(0,o.jsxs)("div",{className:"card",children:[(0,o.jsx)("h2",{children:"Flat authorizations"}),(0,o.jsx)("pre",{children:u?JSON.stringify(u,null,2):"Click Load AuthZ"})]}),(0,o.jsxs)("div",{className:"card",children:[(0,o.jsx)("h2",{children:"Context authorizations"}),(0,o.jsx)("pre",{children:d?JSON.stringify(d,null,2):"Click Load Context"})]})]})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=4934)}),_N_E=e.O()}]);